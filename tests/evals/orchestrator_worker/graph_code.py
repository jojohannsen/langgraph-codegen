# Generated by claude-3-7-sonnet-latest

from langgraph.graph import START, END, StateGraph
from langgraph.constants import Send

# Import the state and node functions
from state_code import State
from node_code import orchestrator, worker, synthesizer

# Routing function for worker node
def assign_workers(state: State):
    """Assign a worker to each section in the state.sections list"""
    # Kick off section processing in parallel via Send() API
    return [Send("worker", {"section": section}) for section in state.sections]

def make_builder():
    """Create and configure the StateGraph for the report generation workflow"""
    # Initialize the StateGraph with our State class
    builder = StateGraph(State)
    
    # Add node functions
    builder.add_node("orchestrator", orchestrator)
    builder.add_node("worker", worker)
    builder.add_node("synthesizer", synthesizer)
    
    # Add standard edges
    builder.add_edge(START, "orchestrator")
    builder.add_edge("worker", "synthesizer")
    builder.add_edge("synthesizer", END)
    
    # Add worker node edge - this is special handling for parallel processing
    # The orchestrator generates sections, and each section is processed by a worker
    builder.add_conditional_edges(
        "orchestrator", assign_workers, ["worker"]
    )
    
    return builder