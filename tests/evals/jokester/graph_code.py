# Generated by claude-sonnet-4-20250514

from langchain_core.runnables.config import RunnableConfig
from langgraph.graph import START, END, StateGraph
from state_code import JokesterState
from node_code import get_joke_topic, tell_joke, ask_for_another


# Routing Functions

def tell_another(state: JokesterState):
    """Routes to get_joke_topic if user wants another joke, otherwise ends the conversation"""
    if state.wants_another_joke:
        return 'get_joke_topic'
    else:
        return 'END'


def make_builder():
    builder = StateGraph(JokesterState)

    # Add node functions
    builder.add_node('get_joke_topic', get_joke_topic)
    builder.add_node('tell_joke', tell_joke)
    builder.add_node('ask_for_another', ask_for_another)

    # Add edges for execution flow
    builder.add_edge(START, 'get_joke_topic')
    builder.add_edge('get_joke_topic', 'tell_joke')
    builder.add_edge('tell_joke', 'ask_for_another')

    # Conditional routing from ask_for_another node
    # Note the special handling for END, we automatically map the string 'END' to the constant END.
    # This means the Routing Function returns the string values 'get_joke_topic' and 'END', and these map to 'get_joke_topic' and END (the constant, special case only for 'END')
    conditional_edges = { 'get_joke_topic': 'get_joke_topic', 'END': END }
    builder.add_conditional_edges('ask_for_another', tell_another, conditional_edges)
    
    return builder